Object.display = function(object) { var s = ""; if (typeof object === "object" && object !== null) { s += object.constructor.name + " {\n"; for (let x in object) { s += `${x}: ${object[x]}\n`; } s += "}"; } else { s += object; } console.log(s); }; class Random { #value = Random.value; constructor() { return null; } static get value() { return Math.random(); } static int(a,b = 0) { const minimum = Math.min(a,b); const range = Math.abs(a-b)+1; return minimum + Math.floor(range * Random.value); } static pick(...elements) { var choices = elements; if (elements.length < 2) choices = elements[0]; if (!Array.isArray(choices)) choices = [choices]; return choices[Random.int(choices.length - 1)]; } get value() { return this.#value; } } class XMLElement { #main; #namespace; constructor(XMLObject, setters = null) { this.#main = XMLObject; this.#namespace = this.#main.namespaceURI || null; if(setters) { if(!Array.isArray(setters)) setters = Object.entries(setters); setters.storage = {}; setters.forEach(property => { var key, value; if(Array.isArray(property)) [key, value] = property; else { key = property; value = null; } if(key.slice(-1) == "*") { key = key.slice(0, -1); setters.storage[key] = { value: this.#main[key], enumerable: true, configurable: true, writable: true, } } else { setters.storage[key] = { set(value) { this.#main.setAttributeNS(null, key, value); }, get() { return this.#main.getAttributeNS(null, key); }, enumerable: true, configurable: true, } } Object.defineProperties(this, setters.storage); if(value !== null && !Number.isNaN(value)) this[key] = value; }); } } get XMLObject() { return this.#main; } get XMLString() { return new XMLSerializer().serializeToString(this.#main); } append(child, next = null, setters = null, namespace = this.#namespace || null) { if (child.constructor.name = "String") child = document.createElementNS(namespace, tag); if(child != null && child.constructor == this.constructor) child = child.XMLObject; if (next != null && next.constructor == this.constructor) next = next.XMLObject; return new this.constructor(this.#main.insertBefore(child, next), setters); } appendGroup(iterable, next = null, setters = null, namespace = this.#namespace || null) { var output = []; [...iterable].forEach(function(child) { output.push(this.#main.append(child)); }); return output; } write(text) { this.#main.append(document.createTextNode(text)); return this; } clear() { this.#main.textContent = ""; return this; } remove() { this.#main.remove(); } on(event, action, ...options) { let obj = {}; options.map(o=>obj[o]=true); this.#main.addEventListener(event, action, obj); return this; } } class XMLDocument { #document; constructor(script = function (root) { return; }, root = "root", namespace = "", doctype = "xml", dtdPUBLIC = "", dtdSYSTEM = "") { this.#document = document.implementation.createDocument(namespace, root, document.implementation.createDocumentType(doctype, dtdPUBLIC, dtdSYSTEM)); script(new XMLElement(this.#document.documentElement)); } get XMLObject() { return this.#document; } get XMLString() { return new XMLSerializer().serializeToString(this.#document); } load() { new XMLElement(document.documentElement).clear().appendGroup(this.#document.documentElement.childNodes); } } class HTMLElement extends XMLElement { #main; #namespace = "http://www.w3.org/1999/xhtml"; constructor(HTMLObject, setters = null) { super(HTMLObject, setters); this.#main = HTMLObject; Object.defineProperty(this, "appendNS", { value: super.append, enumerable: false, }); } get HTMLObject() { return super.XMLObject; } get HTMLString() { return super.HTMLString; } append(child, next = null, setters = null) { return this.appendNS(child, next, setters, this.#namespace); } appendGroup(iterable, next = null, setters = null) { return super.appendGroup(iterable, next, setters); } } class HTMLDocument extends XMLDocument { #document; constructor(script = function (body, head) { return; }, title = document.title) { super(function(root) { return; }, "html", "http://www.w3.org/1999/xhtml", "html"); this.#document.title = title; script(this.#document.body, this.#document.head); } get HTMLObject() { return this.#document; } get HTMLString() { return new XMLSerializer().serializeToString(this.#document); } load(keepHead = true) { if (keepHead) { document.head.textContent = ""; } document.head.append(...this.#document.head.childNodes); document.body.textContent = ""; document.body.append(...this.#document.body.childNodes); } } class SVGElement extends XMLElement { #main; #namespace = "http://www.w3.org/2000/svg"; constructor(SVGObject, setters = null) { super(SVGObject, setters); this.#main = SVGObject; Object.defineProperty(this, "appendNS", { value: super.append, enumerable: false, }); } get SVGObject() { return super.XMLObject; } append(tag, next = null, setters = null) { return this.appendNS(tag, next, setters, this.#namespace); } use(id, next = null) { return super.append("use", next, [["href", "#" + id], "x", "y", "width", "height"], this.#namespace); } }
